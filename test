
# Connexion à la base de données
engine = create_engine('your_database_url')
Base.metadata.create_all(engine)
session = Session(engine)

# ID du trader que vous voulez rechercher
trader_id = 1

# Requête pour obtenir les structures pour un trader donné
stmt = (
    select(Traders)
    .options(joinedload(Traders.allocations).joinedload(TraderAllocation.structure))
    .where(Traders.id_trader == trader_id)
)

# Exécuter la requête
trader = session.scalars(stmt).one()

# Formater les données
formatted_data = {
    "Trader ID": trader.id_trader,
    "Structures": [
        {
            "Structure ID": allocation.structure.id_structure,
            "CDR": allocation.structure.cdr,
            "PS Type": allocation.structure.ps_type,
            "CDR Name": allocation.structure.cdr_name,
            "CDR Name 2": allocation.structure.cdr_name2,
        }
        for allocation in trader.allocations
    ]
}

# Afficher les données formatées
import pprint
pprint.pprint(formatted_data)