
Sub MettreAJourCodeM()
    Dim wb As Workbook
    Dim pq As WorkbookQuery
    Dim nouveauCodeM As String
    Dim nomRequete As String

    ' Définir le classeur actif
    Set wb = ThisWorkbook

    ' Spécifiez ici le nom de la requête Power Query que vous souhaitez mettre à jour
    nomRequete = "NomDeVotreRequete"
    
    ' Code M mis à jour
    nouveauCodeM = "let" & vbCrLf & _
                   "    Source = Excel.CurrentWorkbook(){[Name=""Table1""]}[Content]," & vbCrLf & _
                   "    FiltrerLignes = Table.SelectRows(Source, each ([Colonne1] = ""Valeur""))" & vbCrLf & _
                   "in" & vbCrLf & _
                   "    FiltrerLignes"
    
    ' Boucler sur toutes les requêtes pour trouver la requête à mettre à jour
    For Each pq In wb.Queries
        If pq.Name = nomRequete Then
            ' Mettre à jour le code M
            pq.Formula = nouveauCodeM
            
            ' Informer l'utilisateur que la mise à jour a été effectuée
            MsgBox "La requête '" & nomRequete & "' a été mise à jour avec succès.", vbInformation
            Exit For
        End If
    Next pq
End Sub