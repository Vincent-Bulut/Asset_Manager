
<script>
    // Fonction pour initialiser les boutons sur toutes les sections avec la classe 'repeatable'
    function initializeCloneAndRemoveButtons(selector) {
        const targetDivs = document.querySelectorAll(selector);

        targetDivs.forEach((div, index) => {
            addButtonsIfNeeded(div, index === 0); // Ajouter les boutons, mais pas le Trash pour le premier élément
            attachEventListeners(div, index === 0);
        });
    }

    // Fonction pour ajouter les boutons manquants à une section
    function addButtonsIfNeeded(section, isFirst) {
        // Bouton pour cloner (ajouter)
        if (!section.querySelector('.clone-btn')) {
            const cloneButton = document.createElement('button');
            cloneButton.innerHTML = '<i class="fas fa-plus"></i>'; // "+" icon
            cloneButton.className = 'clone-btn';
            cloneButton.addEventListener('click', () => cloneSection(section));
            section.prepend(cloneButton);
        }

        // Bouton pour toggle (expand/collapse)
        if (!section.querySelector('.toggle-btn')) {
            const toggleButton = document.createElement('button');
            toggleButton.innerHTML = '<i class="fas fa-minus"></i>'; // "-" icon
            toggleButton.className = 'toggle-btn';
            toggleButton.addEventListener('click', () => toggleSection(section, toggleButton));
            section.prepend(toggleButton);
        }

        // Bouton pour supprimer (Trash) - ne l'ajoute que si ce n'est pas le premier élément
        if (!isFirst && !section.querySelector('.remove-btn')) {
            const removeButton = document.createElement('button');
            removeButton.innerHTML = '<i class="fas fa-trash"></i>'; // Trash icon
            removeButton.className = 'remove-btn';
            removeButton.addEventListener('click', () => section.remove());
            section.prepend(removeButton);
        }
    }

    // Fonction pour attacher les événements aux boutons d'une section
    function attachEventListeners(section, isFirst) {
        const cloneButton = section.querySelector('.clone-btn');
        const toggleButton = section.querySelector('.toggle-btn');
        const removeButton = section.querySelector('.remove-btn');

        // Re-attacher les événements pour éviter les doublons
        if (cloneButton) {
            cloneButton.onclick = () => cloneSection(section);
        }
        if (toggleButton) {
            toggleButton.onclick = () => toggleSection(section, toggleButton);
        }
        if (removeButton && !isFirst) {
            removeButton.onclick = () => section.remove();
        }
    }

    // Fonction pour cloner une section
    function cloneSection(section) {
        const clone = section.cloneNode(true); // Clone complet de la section

        // Ajouter les boutons pour le clone (y compris le bouton Trash)
        addButtonsIfNeeded(clone, false); // false indique que ce n'est pas le premier élément
        attachEventListeners(clone, false);

        // Insérer le clone après la section originale
        section.parentNode.insertBefore(clone, section.nextSibling);
    }

    // Fonction pour basculer l'affichage d'une section (expand/collapse)
    function toggleSection(section, toggleButton) {
        const content = Array.from(section.children).slice(3); // Ignorer les premiers enfants (boutons)

        content.forEach(child => {
            if (child.style.display === 'none') {
                child.style.display = ''; // Ré-afficher le contenu
                toggleButton.innerHTML = '<i class="fas fa-minus"></i>'; // Changer l'icône pour "-"
            } else {
                child.style.display = 'none'; // Masquer le contenu
                toggleButton.innerHTML = '<i class="fas fa-plus"></i>'; // Changer l'icône pour "+"
            }
        });
    }

    // Initialisation des boutons au chargement de la page
    document.addEventListener('DOMContentLoaded', () => {
        initializeCloneAndRemoveButtons('.repeatable');
    });
</script>