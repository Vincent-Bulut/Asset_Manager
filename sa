
import axios from 'axios';

async function envoyerXMLVersAPI(xml) {
    try {
        // Envoyer la requête POST et récupérer la réponse en tant que blob
        const response = await axios.post(
            "/export/zip-and-encrypt/",
            null, // Si pas de body, laissez null ou ajoutez des paramètres
            {
                params: { dac6_xml: xml }, // Paramètres dans l'URL
                responseType: "blob"      // Indique qu'on attend un fichier binaire
            }
        );

        // Créer un Blob à partir de la réponse
        const blob = new Blob([response.data], { type: "application/octet-stream" });

        // Générer une URL temporaire pour le Blob
        const downloadUrl = URL.createObjectURL(blob);

        // Créer un lien de téléchargement dynamique
        const link = document.createElement("a");
        link.href = downloadUrl;
        link.download = "fichier_chiffre.gpg"; // Nom du fichier à télécharger
        document.body.appendChild(link);
        link.click(); // Simuler un clic pour démarrer le téléchargement
        document.body.removeChild(link); // Nettoyer après le téléchargement

        // Libérer l'URL temporaire
        URL.revokeObjectURL(downloadUrl);

        console.log("Téléchargement réussi !");
    } catch (error) {
        console.error("Erreur lors de l'appel API :", error.response ? error.response.data : error.message);
    }
}