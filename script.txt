
<script>
  async function downloadFile(id_folder, s3_key) {
    try {
      // Construire l'URL de l'API
      const url = `/api/${id_folder}/files/${s3_key}`;

      // Faire une requête GET pour récupérer le fichier
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error('Erreur lors du téléchargement du fichier');
      }

      // Extraire le fichier sous forme de blob
      const blob = await response.blob();

      // Créer une URL temporaire pour le blob
      const blobUrl = URL.createObjectURL(blob);

      // Créer un lien temporaire pour déclencher le téléchargement
      const link = document.createElement('a');
      link.href = blobUrl;

      // Définir le nom du fichier à télécharger (récupérer depuis la réponse ou un fallback)
      const contentDisposition = response.headers.get('content-disposition');
      let filename = 'downloaded_file';
      if (contentDisposition) {
        const matches = contentDisposition.match(/filename="(.+)"/);
        if (matches && matches[1]) {
          filename = matches[1];
        }
      }
      link.download = filename;

      // Ajouter le lien au DOM, cliquer dessus, et le supprimer
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      // Nettoyer l'URL blob pour éviter des fuites de mémoire
      URL.revokeObjectURL(blobUrl);
    } catch (error) {
      console.error('Erreur lors du téléchargement:', error);
      alert('Impossible de télécharger le fichier');
    }
  }
</script>