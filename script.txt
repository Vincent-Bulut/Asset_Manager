
from sqlalchemy.orm import sessionmaker
# Importez vos classes de modèle ici
from your_module import BusinessManager, Traders, TraderTimes, TraderAllocation, Structure, Entity

# Créer une session avec la base de données
Session = sessionmaker(bind=your_engine)
session = Session()

# Remplacer 'some_ut' par le 'ut' réel du BusinessManager que vous recherchez
business_manager_ut = 'some_ut'

# Construction de la requête
result = session.query(BusinessManager).join(
    Traders, BusinessManager.ut == Traders.ut_bm
).join(
    TraderAllocation, Traders.id_trader == TraderAllocation.id_trader
).join(
    Structure, Structure.id_structure == TraderAllocation.id_structure
).join(
    TraderTimes, Traders.id_trader == TraderTimes.id_trader
).join(
    Entity, Traders.entity_code == Entity.entity_code
).filter(
    BusinessManager.ut == business_manager_ut
).all()

# Fermer la session
session.close()

# Traiter le résultat
for bm in result:
    # Accédez ici aux attributs et aux relations
    print(bm.ut, bm.ut_delegated, bm.publication_status, bm.list_traders)
    for trader in bm.list_traders:
        print(trader.ut, trader.start_date, trader.end_date, ...)
        for allocation in trader.structures_alloc:
            print(allocation.structure, allocation.trader_times, ...)
            # Continuer pour accéder à d'autres attributs si nécessaire