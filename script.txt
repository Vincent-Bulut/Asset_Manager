
<script>
  import { onMount } from "svelte";

  let files = [];
  let uploading = false;

  async function handleDrop(event) {
    event.preventDefault();
    const droppedFiles = [...event.dataTransfer.files]; // Fichiers drag & drop
    files = droppedFiles; // Liste des fichiers sélectionnés

    await uploadFiles();
  }

  async function uploadFiles() {
    uploading = true;

    for (let file of files) {
      // Demandez une URL pré-signée à votre backend
      const response = await fetch('/generate-presigned-url', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fileName: file.name, fileType: file.type }),
      });

      const { url } = await response.json();

      // Téléchargez le fichier vers S3
      await fetch(url, {
        method: 'PUT',
        headers: { 'Content-Type': file.type },
        body: file,
      });
    }

    uploading = false;
    alert('Fichiers uploadés avec succès !');
  }

  function handleDragOver(event) {
    event.preventDefault(); // Empêche le comportement par défaut (ouvrir le fichier dans le navigateur)
  }
</script>

<style>
  .dropzone {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.3s;
  }
  .dropzone:hover {
    border-color: #000;
  }
  .uploading {
    color: green;
  }
</style>

<div 
  class="dropzone" 
  on:drop={handleDrop} 
  on:dragover={handleDragOver}
>
  {#if uploading}
    <p class="uploading">Upload en cours...</p>
  {:else}
    <p>Glissez et déposez vos fichiers ici ou cliquez pour sélectionner</p>
  {/if}
</div>
